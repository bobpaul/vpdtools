#!/bin/bash
#
# Copyright (c) 2018 Raptor Engineering, LLC
# Released under the terms of the AGPL v3

OVERRIDE_FILE=overclock_data.txt
VOLT_OFFSET=0

if [[ "$1" == "" ]]; then
        echo "Usage: ${0} <frequency boost percentage, e.g. 10 for 10% boost>"
fi
if [[ "$2" != "" ]]; then
	VOLT_OFFSET=${2}
fi

FREQ_OFFSET=$(( $1 * 2 ))
FREQ_PERCENTAGE_TEXT=$(printf "0x%X" $FREQ_OFFSET)
VOLT_PERCENTAGE_TEXT=$(printf "0x%X" $VOLT_OFFSET)

echo "CLEAR" > $OVERRIDE_FILE
echo "" >> $OVERRIDE_FILE
echo "target = k0:s0:n0:p9:pall" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_NOMINAL ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDN_BIAS ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_NOMINAL ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_POWERSAVE ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_TURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_TURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VCS_BIAS ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_POWERSAVE ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_ULTRATURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_ULTRATURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_NOMINAL ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_ULTRATURBO ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_TURBO ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_POWERSAVE ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "" >> $OVERRIDE_FILE
echo "target = k0:s0:n1:p9:pall" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_NOMINAL ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDN_BIAS ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_NOMINAL ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_POWERSAVE ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_TURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_TURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VCS_BIAS ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_POWERSAVE ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_INT_VDD_BIAS_ULTRATURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_VOLTAGE_EXT_VDD_BIAS_ULTRATURBO ${VOLT_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_NOMINAL ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_ULTRATURBO ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_TURBO ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
echo "ATTR_FREQ_BIAS_POWERSAVE ${FREQ_PERCENTAGE_TEXT}" >> $OVERRIDE_FILE
